<!DOCTYPE html>
<html lang="fr-FR" class="no-js">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width">
	<link rel="profile" href="https://gmpg.org/xfn/11">
	<link rel="pingback" href="https://thomas-veillard.fr/xmlrpc.php">
	<!--[if lt IE 9]>
	<script src="https://thomas-veillard.fr/wp-content/themes/twentyfifteen/js/html5.js?ver=3.7.0"></script>
	<![endif]-->
	<script>(function(html){html.className = html.className.replace(/\bno-js\b/,'js')})(document.documentElement);</script>
<meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">

	<!-- This site is optimized with the Yoast SEO plugin v17.9 - https://yoast.com/wordpress/plugins/seo/ -->
	<title>02. Vue: practical activity, part n°2 - Thomas VEILLARD</title>
	<link rel="canonical" href="https://thomas-veillard.fr/front-end-web-development/vue/02-vue-practical-activity-part-n2/">
	<meta property="og:locale" content="fr_FR">
	<meta property="og:type" content="article">
	<meta property="og:title" content="02. Vue: practical activity, part n°2 - Thomas VEILLARD">
	<meta property="og:description" content="Learning outcomes Getting started with Oauth2, OpenID, etc. Understand the need for a state management layer in your app. Exploring various state management strategies. Discuss pros and cons of various state management patterns. Handle in-browser routing and discuss its performance concerns. Using route guards to prevent activation of some routes. The expected result At the &hellip; Continuer la lecture de 02. Vue: practical activity, part n°2">
	<meta property="og:url" content="https://thomas-veillard.fr/front-end-web-development/vue/02-vue-practical-activity-part-n2/">
	<meta property="og:site_name" content="Thomas VEILLARD">
	<meta property="article:published_time" content="2021-10-11T05:11:51+00:00">
	<meta property="article:modified_time" content="2022-08-23T16:05:43+00:00">
	<meta property="og:image" content="https://thomas-veillard.fr/wp-content/uploads/2021/09/signin-button.gif">
	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:label1" content="Écrit par">
	<meta name="twitter:data1" content="Thomas Veillard">
	<meta name="twitter:label2" content="Durée de lecture estimée">
	<meta name="twitter:data2" content="11 minutes">
	<script type="application/ld+json" class="yoast-schema-graph">{
	    "@context": "https://schema.org",
	    "@graph": [
	        {
	            "@type": "WebSite",
	            "@id": "https://thomas-veillard.fr/#website",
	            "url": "https://thomas-veillard.fr/",
	            "name": "Thomas VEILLARD",
	            "description": "Mes cours et supports pédagogiques pour l&#039;enseignement de l&#039;ingénierie informatique.",
	            "publisher": {
	                "@id": "https://thomas-veillard.fr/#/schema/person/98465ef1c45a4646324ef7c336388ffb"
	            },
	            "inLanguage": "fr-FR"
	        },
	        {
	            "@type": "ImageObject",
	            "@id": "https://thomas-veillard.fr/front-end-web-development/vue/02-vue-practical-activity-part-n2/#primaryimage",
	            "inLanguage": "fr-FR",
	            "url": "https://thomas-veillard.fr/wp-content/uploads/2021/09/signin-button.gif",
	            "contentUrl": "https://thomas-veillard.fr/wp-content/uploads/2021/09/signin-button.gif",
	            "width": 1060,
	            "height": 836
	        },
	        {
	            "@type": "WebPage",
	            "@id": "https://thomas-veillard.fr/front-end-web-development/vue/02-vue-practical-activity-part-n2/#webpage",
	            "url": "https://thomas-veillard.fr/front-end-web-development/vue/02-vue-practical-activity-part-n2/",
	            "name": "02. Vue: practical activity, part n°2 - Thomas VEILLARD",
	            "isPartOf": {
	                "@id": "https://thomas-veillard.fr/#website"
	            },
	            "primaryImageOfPage": {
	                "@id": "https://thomas-veillard.fr/front-end-web-development/vue/02-vue-practical-activity-part-n2/#primaryimage"
	            },
	            "datePublished": "2021-10-11T05:11:51+00:00",
	            "dateModified": "2022-08-23T16:05:43+00:00",
	            "breadcrumb": {
	                "@id": "https://thomas-veillard.fr/front-end-web-development/vue/02-vue-practical-activity-part-n2/#breadcrumb"
	            },
	            "inLanguage": "fr-FR",
	            "potentialAction": [
	                {
	                    "@type": "ReadAction",
	                    "target": [
	                        "https://thomas-veillard.fr/front-end-web-development/vue/02-vue-practical-activity-part-n2/"
	                    ]
	                }
	            ]
	        },
	        {
	            "@type": "BreadcrumbList",
	            "@id": "https://thomas-veillard.fr/front-end-web-development/vue/02-vue-practical-activity-part-n2/#breadcrumb",
	            "itemListElement": [
	                {
	                    "@type": "ListItem",
	                    "position": 1,
	                    "name": "Accueil",
	                    "item": "https://thomas-veillard.fr/"
	                },
	                {
	                    "@type": "ListItem",
	                    "position": 2,
	                    "name": "02. Vue: practical activity, part n°2"
	                }
	            ]
	        },
	        {
	            "@type": "Article",
	            "@id": "https://thomas-veillard.fr/front-end-web-development/vue/02-vue-practical-activity-part-n2/#article",
	            "isPartOf": {
	                "@id": "https://thomas-veillard.fr/front-end-web-development/vue/02-vue-practical-activity-part-n2/#webpage"
	            },
	            "author": {
	                "@id": "https://thomas-veillard.fr/#/schema/person/98465ef1c45a4646324ef7c336388ffb"
	            },
	            "headline": "02. Vue: practical activity, part n°2",
	            "datePublished": "2021-10-11T05:11:51+00:00",
	            "dateModified": "2022-08-23T16:05:43+00:00",
	            "mainEntityOfPage": {
	                "@id": "https://thomas-veillard.fr/front-end-web-development/vue/02-vue-practical-activity-part-n2/#webpage"
	            },
	            "wordCount": 1795,
	            "publisher": {
	                "@id": "https://thomas-veillard.fr/#/schema/person/98465ef1c45a4646324ef7c336388ffb"
	            },
	            "image": {
	                "@id": "https://thomas-veillard.fr/front-end-web-development/vue/02-vue-practical-activity-part-n2/#primaryimage"
	            },
	            "thumbnailUrl": "https://thomas-veillard.fr/wp-content/uploads/2021/09/signin-button.gif",
	            "articleSection": [
	                "03. VueJS",
	                "Modern web development"
	            ],
	            "inLanguage": "fr-FR"
	        },
	        {
	            "@type": [
	                "Person",
	                "Organization"
	            ],
	            "@id": "https://thomas-veillard.fr/#/schema/person/98465ef1c45a4646324ef7c336388ffb",
	            "name": "Thomas Veillard",
	            "image": {
	                "@type": "ImageObject",
	                "@id": "https://thomas-veillard.fr/#personlogo",
	                "inLanguage": "fr-FR",
	                "url": "http://2.gravatar.com/avatar/2008ad33ccb3924190bb884024ca6114?s=96&d=mm&r=g",
	                "contentUrl": "http://2.gravatar.com/avatar/2008ad33ccb3924190bb884024ca6114?s=96&d=mm&r=g",
	                "caption": "Thomas Veillard"
	            },
	            "logo": {
	                "@id": "https://thomas-veillard.fr/#personlogo"
	            },
	            "sameAs": [
	                "https://thomas-veillard.fr:8080"
	            ]
	        }
	    ]
	}</script>
	<!-- / Yoast SEO plugin. -->


<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link href="https://fonts.gstatic.com/" crossorigin rel="preconnect">
<link rel="alternate" type="application/rss+xml" title="Thomas VEILLARD &raquo; Flux" href="https://thomas-veillard.fr/feed/">
<link rel="alternate" type="application/rss+xml" title="Thomas VEILLARD &raquo; Flux des commentaires" href="https://thomas-veillard.fr/comments/feed/">
<link rel="stylesheet" id="wp-block-library-css" href="https://thomas-veillard.fr/wp-includes/css/dist/block-library/style.min.css?ver=5.7.4" media="all">
<link rel="stylesheet" id="wp-block-library-theme-css" href="https://thomas-veillard.fr/wp-includes/css/dist/block-library/theme.min.css?ver=5.7.4" media="all">
<link rel="stylesheet" id="dashicons-css" href="https://thomas-veillard.fr/wp-includes/css/dashicons.min.css?ver=5.7.4" media="all">
<link rel="stylesheet" id="vlp-public-css" href="https://thomas-veillard.fr/wp-content/plugins/visual-link-preview/dist/public.css?ver=2.2.1" media="all">
<link rel="stylesheet" id="twentyfifteen-fonts-css" href="https://fonts.googleapis.com/css?family=Noto+Sans%3A400italic%2C700italic%2C400%2C700%7CNoto+Serif%3A400italic%2C700italic%2C400%2C700%7CInconsolata%3A400%2C700&#038;subset=latin%2Clatin-ext&#038;display=fallback" media="all">
<link rel="stylesheet" id="genericons-css" href="https://thomas-veillard.fr/wp-content/themes/twentyfifteen/genericons/genericons.css?ver=20201208" media="all">
<link rel="stylesheet" id="twentyfifteen-style-css" href="https://thomas-veillard.fr/wp-content/themes/twentyfifteen/style.css?ver=20201208" media="all">
<link rel="stylesheet" id="twentyfifteen-block-style-css" href="https://thomas-veillard.fr/wp-content/themes/twentyfifteen/css/blocks.css?ver=20190102" media="all">
<!--[if lt IE 9]>
<link rel='stylesheet' id='twentyfifteen-ie-css'  href='https://thomas-veillard.fr/wp-content/themes/twentyfifteen/css/ie.css?ver=20170916' media='all' />
<![endif]-->
<!--[if lt IE 8]>
<link rel='stylesheet' id='twentyfifteen-ie7-css'  href='https://thomas-veillard.fr/wp-content/themes/twentyfifteen/css/ie7.css?ver=20141210' media='all' />
<![endif]-->
<script src="https://thomas-veillard.fr/wp-includes/js/jquery/jquery.min.js?ver=3.5.1" id="jquery-core-js"></script>
<script src="https://thomas-veillard.fr/wp-includes/js/jquery/jquery-migrate.min.js?ver=3.3.2" id="jquery-migrate-js"></script>
<link rel="https://api.w.org/" href="https://thomas-veillard.fr/wp-json/">
<link rel="alternate" type="application/json" href="https://thomas-veillard.fr/wp-json/wp/v2/posts/3522">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://thomas-veillard.fr/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://thomas-veillard.fr/wp-includes/wlwmanifest.xml"> 
<meta name="generator" content="WordPress 5.7.4">
<link rel="shortlink" href="https://thomas-veillard.fr/?p=3522">
<link rel="alternate" type="application/json+oembed" href="https://thomas-veillard.fr/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhttps://thomas-veillard.fr%2Ffront-end-web-development%2Fvue%2F02-vue-practical-activity-part-n2%2F">
<link rel="alternate" type="text/xml+oembed" href="https://thomas-veillard.fr/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fhttps://thomas-veillard.fr%2Ffront-end-web-development%2Fvue%2F02-vue-practical-activity-part-n2%2F&#038;format=xml">
		<style id="wp-custom-css">.entry-title {
	font-size: 1.6em !important;
	text-align: left;
}

article {
	text-align: justify;
	font-size: 0.9em;
}

@media screen and (min-width: 59.6875em) {
	.site-header {
		padding: 0 1em;
	}

	.main-navigation {
		margin: 1em;
	}
}

.main-navigation .current-menu-item > a, .main-navigation .current-menu-ancestor > a {
	font-weight: unset;
	color: black;
}

.main-navigation a {
	color: #666;
}

.no-puce, .no-puce ul {
	list-style-type: none;
}

table {
	margin-bottom: 0;
}

figcaption {
	margin-bottom: 1em !important;
}

h4 {
	margin-top: 1em !important;
	font-size: 1.25em !important;
}

h5 {
	font-size: 1em !important;
	text-transform: none !important;
	margin-top: 1em !important;
}

.exercice {
  padding: 1em;
  border-radius: 3px;
  border: 1px solid #795548;
  background: #f7f7f7;
}

.question {
  padding: 1em;
  border-radius: 3px;
  border: 1px solid #ab47bc;
  background: #f3e5f5;
}

.video-container {
	position: relative;
	padding-bottom: 56.25%; /* 16:9 */
	height: 0;
	margin-bottom: 1em;
}
.video-container iframe {
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
}

.card {
  background: #fff;
  border-radius: 2px;
  padding: 2rem 1rem;
}

.card-1 {
  box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
  transition: all 0.3s cubic-bezier(.25,.8,.25,1);
}

.card-1-hoverable:hover {
  box-shadow: 0 14px 28px rgba(0,0,0,0.25), 0 10px 10px rgba(0,0,0,0.22);
}

.post-thumbnail {
	margin-bottom: 0;
}

.entry-header {
	color: rgba(51, 51, 51, 0.7);
	font-family: "Noto Sans", sans-serif;
	background-color: #f7f7f7;
	padding-top: 2em;
	padding-bottom: 2em;
	margin-bottom: 1em;
}

.entry-title {
	margin: 0;
	font-weight: normal;
}

.hentry {
	padding-top: 0 !important;
}

table {
	table-layout: auto;
}

.menu-fr > a:before,
.menu-en > a:before {
	content: '';
	display: inline-block;
	width: 1.3em;
	height: 1em;
	margin-right: 0.5em;
}

.menu-fr > a:before {
	background-image: url('https://thomas-veillard.fr/wp-content/uploads/2021/04/fr.svg');
}

.menu-en > a:before {
	background-image: url('https://thomas-veillard.fr/wp-content/uploads/2021/04/en.svg');
}

blockquote, cite {
	font-size: 1em !important;
}

.ui-accordion-header h4 {
	margin-top: 0 !important;
}

.u-mbs { margin-bottom: 0.25em; }
.u-mlm { margin-left: 1em; }

.strikethrough {
	text-decoration: line-through;
}</style>
		</head>

<body class="post-template-default single single-post postid-3522 single-format-standard wp-embed-responsive">
<div id="page" class="hfeed site">
	<a class="skip-link screen-reader-text" href="#content">Aller au contenu</a>

	<div id="sidebar" class="sidebar">
		<header id="masthead" class="site-header" role="banner">
			<div class="site-branding">
										<p class="site-title"><a href="https://thomas-veillard.fr/" rel="home">Thomas VEILLARD</a></p>
												<p class="site-description">Mes cours et supports pédagogiques pour l&#039;enseignement de l&#039;ingénierie informatique.</p>
										<button class="secondary-toggle">Menu			</button>
</div>
<!-- .site-branding -->
		</header><!-- .site-header -->

			<div id="secondary" class="secondary">

					<nav id="site-navigation" class="main-navigation" role="navigation">
				<div class="menu-theorie-des-systemes-dexploitation-et-pratique-de-gnu-linux-container"><ul id="menu-theorie-des-systemes-dexploitation-et-pratique-de-gnu-linux" class="nav-menu">
<li id="menu-item-135" class="menu-fr menu-item menu-item-type-taxonomy menu-item-object-category menu-item-has-children menu-item-135">
<a href="https://thomas-veillard.fr/category/theorie-des-systemes-dexploitation-et-pratique-de-gnu-linux/">Théorie des systèmes d’exploitation et pratique de GNU/Linux</a>
<ul class="sub-menu">
	<li id="menu-item-49" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-49"><a href="https://thomas-veillard.fr/category/theorie-des-systemes-dexploitation-et-pratique-de-gnu-linux/chapitre-1-introduction/">Chapitre 1. Introduction</a></li>
	<li id="menu-item-558" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-558"><a href="https://thomas-veillard.fr/category/theorie-des-systemes-dexploitation-et-pratique-de-gnu-linux/chapitre-2-les-interfaces-utilisateur/">Chapitre 2. Les interfaces utilisateur</a></li>
</ul>
</li>
<li id="menu-item-1097" class="menu-en menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-has-children menu-item-1097">
<a href="https://thomas-veillard.fr/category/front-end-web-development/">Modern web development</a>
<ul class="sub-menu">
	<li id="menu-item-1366" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-1366"><a href="https://thomas-veillard.fr/category/front-end-web-development/introduction/">Introduction</a></li>
	<li id="menu-item-2642" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-2642"><a href="https://thomas-veillard.fr/category/front-end-web-development/languages/">Languages</a></li>
</ul>
</li>
</ul></div>			</nav><!-- .main-navigation -->
		
		
		
	</div>
<!-- .secondary -->

	</div>
<!-- .sidebar -->

	<div id="content" class="site-content">

	<div id="primary" class="content-area">
		<main id="main" class="site-main" role="main">

		
<article id="post-3522" class="post-3522 post type-post status-publish format-standard hentry category-vue category-front-end-web-development">
	
	
	<header class="entry-header">
		<h1 class="entry-title">Vue: practical activity, part n°2</h1>	</header><!-- .entry-header -->

	<div class="entry-content">
		
<h4>Learning outcomes</h4>



<ul>
<li>Getting started with Oauth2, OpenID, etc.</li>
<li>Understand the need for a state management layer in your app.</li>
<li>Exploring various state management strategies.</li>
<li>Discuss pros and cons of various state management patterns.</li>
<li>Handle in-browser routing and discuss its performance concerns.</li>
<li>Using route guards to prevent activation of some routes.</li>
</ul>



<h4>The expected result</h4>



<p>At the end of the tutorial, the user will be able to login with its Microsoft account. The application will fetch and display its identity (basically its id, email and name). The current user identity is something you need in the whole app. You will explore various ways to achieve this.</p>



<p><i class="fas fa-info-circle" style="color: #5c6bc0; margin-right: 0.5em"></i> A test microsoft account will be provided in session by your teacher, but you are free to use your own account. During this tutorial, you will only grant access to basic profile information (name and email). API secrets stay in your browser, except when calling the API of course. You can revoke permissions at any time in the confidentiality screen of the Microsoft account.</p>



<h4>Oauth2, OpenID, Microsoft Graph API&#8230; What is it?</h4>



<p>In the continuation of the previous tutorial, the application will gain access to the Microsoft Graph API. This one exposes a large panel of Microsoft&rsquo;s SaaS products, including Outlook.</p>



<p>The <strong>Microsoft Graph API</strong> acts on the side of a logged-in user, that must grant permission to the application. The<strong> Oauth2 protocol </strong>is responsible for authentication and collection of user&rsquo;s consent. In the terminology of Oauth2, a permission is called a <strong>scope</strong>. The application must explicitly declare which <strong>scopes</strong> it needs.</p>



<p>Once authorised, the application gets an <strong>access token</strong> (aka. <strong>Bearer</strong>). This is just a long random string you must provide within each API query. The API knows everything about it (which user, scopes, application&#8230;). This short living key is strictly confidential and expires in about 1 hour, unless the user manually revokes it. Note that the oauth2 protocol also allows the app renewing it without user interaction.</p>



<p><strong>OpenID</strong> is another protocol built on top of Oauth2. It allows the user to share its identity (just the name and email) to the application. This way, the application just trusts the identity provider. This is widely used to implement <strong>SSO</strong> (aka. <strong>Single Sign On</strong>), allowing using a single account to sign-in on any application supporting this identity provider.</p>



<h4>The SigninButton component</h4>



<p>Let&rsquo;s build a <code>SigninButton</code> responsible for retrieving an <strong>access token</strong> and the associated user identity. Microsoft provides a library making this process easier: <a href="https://www.npmjs.com/package/@azure/msal-browser" target="_blank" rel="noreferrer noopener">@azure/msal-browser</a>.</p>



<p>Acquiring the user authorisation and fetching identity from the API is typically an async task that lasts a few seconds. So it is an opportunity to use <code>AsyncButton</code>.</p>



<p>Additionally, the SPA should be registered on Azure Active Directory portal. But do not worry too much about it, since I have already done it. Each integration (the name given to an external application registered on Azure AD) has a <strong>clientId</strong> used in Oauth2 protocol.</p>



<p>From a security and maintainability perspective, you should never let secrets and configurations hardcoded in your code. Instead, extract them to a configuration file ignored by git. Even better, allow those settings to be different depending on the environment (ex. test, development, staging, production&#8230;). The Vue assets pipeline has a built-in feature for this: <a href="https://cli.vuejs.org/guide/mode-and-env.html" target="_blank" rel="noreferrer noopener">env variables</a>.</p>


<pre class="wp-block-code" aria-describedby="shcb-language-1" data-shcb-language-name="PHP" data-shcb-language-slug="php"><link rel="stylesheet" id="syntax-highlighting-code-block-css" href="https://thomas-veillard.fr/wp-content/plugins/syntax-highlighting-code-block/vendor/scrivo/highlight-php/styles/default.css?ver=1.3.1" media="all"><div><code class="hljs language-php"><span class="hljs-comment"># file: .env.development.local</span>
VUE_APP_OAUTH_CLIENT_ID=e8137439<span class="hljs-number">-4</span>d1d<span class="hljs-number">-462</span>d-a85f-f81cfea8f0d8</code></div><small class="shcb-language" id="shcb-language-1"><span class="shcb-language__label">Langage du code :</span> <span class="shcb-language__name">PHP</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">php</span><span class="shcb-language__paren">)</span></small></pre>


<p><i class="fas fa-exclamation-circle" style="color: #d32f2f; margin-right: 0.5em"></i> Unfortunately, changes appyed to .env files cannot be watched by the cli. Each time, you must restart the building process (ex. npm run serve).</p>



<p class="question"><strong>Question 1</strong>: Why you should not commit credentials on git?</p>



<p class="question"><strong>Question 2</strong>: Why may you want different configurations depending on the environment? Give an example.</p>



<p class="exercice"><strong>Exercice 1</strong>: I already wrote helpers on top of msla (see the file <code>src/lib/microsoftGraph.js</code> above). Import them for use in your <code>SigninButton</code> component.  For now, <code>SigninButton</code> stores the resolved user inside its own state (the <code>data</code> property of your component) and displays it in the template.</p>



<p style="margin-top: -1.5em"><i class="fab fa-git-alt" style="color: #f4511e; margin-right: 0.5em"></i> Commit changes with message « Ex 1: add SigninButton »</p>


<pre class="wp-block-code" aria-describedby="shcb-language-2" data-shcb-language-name="JavaScript" data-shcb-language-slug="javascript"><div><code class="hljs language-javascript"><span class="hljs-comment">// file src/lib/microsoftGraph.js</span>
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> msal <span class="hljs-keyword">from</span> <span class="hljs-string">'@azure/msal-browser'</span>

<span class="hljs-comment">/**
 * List the requested scopes (aka. the requested permissions)
 */</span>
<span class="hljs-keyword">const</span> requestedScopes = {
  <span class="hljs-attr">scopes</span>: [<span class="hljs-string">"User.Read"</span>]
}

<span class="hljs-keyword">const</span> msalInstance = <span class="hljs-keyword">new</span> msal.PublicClientApplication({
  <span class="hljs-attr">auth</span>: {
    <span class="hljs-attr">clientId</span>: process.env.VUE_APP_OAUTH_CLIENT_ID
  },
  <span class="hljs-attr">cache</span>: {
    <span class="hljs-attr">cacheLocation</span>: <span class="hljs-string">"sessionStorage"</span>
  }
})

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">signInAndGetUser</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">const</span> authResult = <span class="hljs-keyword">await</span> msalInstance.loginPopup(requestedScopes)
  msalInstance.setActiveAccount(authResult.account)
  <span class="hljs-keyword">return</span> authResult.account
}</code></div><small class="shcb-language" id="shcb-language-2"><span class="shcb-language__label">Langage du code :</span> <span class="shcb-language__name">JavaScript</span> <span class="shcb-language__paren">(</span><span class="shcb-language__slug">javascript</span><span class="shcb-language__paren">)</span></small></pre>


<figure class="wp-block-image size-large"><img loading="lazy" width="1060" height="836" src="https://thomas-veillard.fr/wp-content/uploads/2021/09/signin-button.gif" alt="" class="wp-image-3576"></figure>



<h4>State management for the current user</h4>



<p>Currently, the identity fetched from Microsoft Graph is stored inside the local state of the  <code>SigninButton</code> component.</p>



<figure class="wp-block-image size-large"><img src="https://thomas-veillard.fr/wp-content/uploads/2021/09/user-stored-in-the-signin-button-component.png" alt="" class="wp-image-3586"><figcaption>Screensheet of vue-devtools, showing the data property of <code>SigninButton</code>.</figcaption></figure>



<p>This means, only that component is currently aware of the connected user:</p>



<ul>
<li>If the component is unmounted, its internal state is, of course, lost.</li>
<li>Only children of <code>SigninButton</code> may potentially get access to that user through <code>props</code>. </li>
</ul>



<p>The current user identity is typically something that should be shared across the whole application (aka. global state). Any component may read it and a few one (the existing <code>SigninButton</code>, a potential <code>SignoutButton</code>&#8230;) need to update it.</p>



<p class="has-text-align-center">***</p>



<p><i class="fas fa-info-circle" style="color: #5c6bc0; margin-right: 0.5em"></i> Now, we want to display the current user name fetched by <code>SigninButton</code> inside the template of <code>HomePage</code>. Let&rsquo;s explore 3 ways to accomplish this.</p>



<h5><span style="color:#a2870d" class="has-inline-color">First solution, use props and events through component tree.</span></h5>



<p>Before going further, please read first <a href="https://v3.vuejs.org/guide/component-basics.html#base-example" target="_blank" rel="noreferrer noopener">Components Basics</a>, <a href="https://v3.vuejs.org/guide/component-props.html#prop-types" target="_blank" rel="noreferrer noopener">Props</a> and <a href="https://v3.vuejs.org/guide/component-custom-events.html" target="_blank" rel="noreferrer noopener">Custom Events</a>. The first proposed solution massively relies on props and events.</p>



<p>The user object is stored at the root of the component tree (inside the <code>App</code> component). When the page loads, the <code>user</code> is <code>null</code> (user not yet logged-in). Any child component that has to read the user object should receive it through props. If the child is nested, every component of the branch must pass the <code>user</code> prop down.</p>



<figure class="wp-block-image size-large"><img loading="lazy" width="1294" height="727" src="https://thomas-veillard.fr/wp-content/uploads/2021/09/props-goes-down.gif" alt="" class="wp-image-3609"><figcaption>Animated flow of props propagation from <code>App</code> to deeply nested children.</figcaption></figure>



<p>Let&rsquo;s suppose now that the user interacts with the <code>SigninButton</code> and sign in. As soon as <code>SigninButton</code> knows the user identity, it emits a custom event called <code>userChanged</code>. Events travel the component tree from bottom to top. Each parent component should handle or propagate the event (or it will be discarded). Eventually, the event reaches the root component <code>App</code>, which consumes it to update its internal state. This triggers a new rendering and the updated identity travels again the tree down through props.</p>



<figure class="wp-block-image size-large"><img loading="lazy" width="1294" height="727" src="https://thomas-veillard.fr/wp-content/uploads/2021/09/event-goes-up.gif" alt="" class="wp-image-3613"><figcaption>Animated flow of events going up, getting handled in App and trigering a view update.</figcaption></figure>


<a href="https://docs.google.com/presentation/d/1FhBhkHADZAE-DtDQU2qk6MczPhqDVYRIyk7ysPOFdA8/edit#slide=id.gebafa763cd_0_119" target="_blank">
  <div style="display: flex; align-items: center; padding: 1em; border-radius: 3px; border: 1px solid #f5ba16; background: #f7f7f7">
    <div style="margin-right: 0.5em"><img src="https://thomas-veillard.fr/wp-content/uploads/2021/01/google_slide.svg"></div>
    <div>Open the animations in Google Slide</div>
  </div>
</a>



<p></p>



<p class="exercice"><strong>Exercise 2</strong>: Use props to share the user with both  <code>SigninComponent</code> and <code>HomePage</code>. Then use events to update the shared user from <code>SigninComponent</code>. Eventually, display the user name in <code>HomePage</code>.</p>



<p class="question"><strong>Question 3</strong>: While being a well-working solution, it suffers from maintainability issues. Please expose and discuss them.</p>



<p>In addition to the reason you may have already found, there is a performance penalty. Did you notice <code>BaseLayout</code> was rendered again because its props changed? But <code>BaseLayout</code> does not need the <code>user</code> props for itself. It just forwards it to children&#8230;</p>



<h5><span style="color:#a2870d" class="has-inline-color">Second solution, use <code>provide</code> and <code>inject</code>.</span></h5>



<p>Read the official documentation carefully for <a href="https://v3.vuejs.org/guide/component-provide-inject.html" target="_blank" rel="noreferrer noopener">Provide &amp; Inject</a>.</p>



<p class="exercice"><strong>Exercise 4</strong>: Replace every needed <code>user</code> props by an <code>inject</code> and remove transitional props that are not useful anymore. For now, you can keep the <code>userChanged</code> event chain. Be sure to make your <code>inject</code> reactive.</p>



<p class="question"><strong>Question 4</strong>: What is the bug if the <code>inject</code> is not reactive?</p>



<p>Actually, you provide the <code>user</code> objet to the <code>App</code>&lsquo;s children, whatever how deep are the consumer components. But updating the value of <code>user</code> inside <code>App</code> still requires to manually propagate events through some component branches.</p>



<p>There are various ways, just by using <code>provide</code> and <code>inject</code>, to trigger a change from a deeply nested component without emitting a chain of events. One of them is to provide a setter, which is just a function. This will be demonstrated by the teacher.</p>



<h5><span style="color:#a2870d" class="has-inline-color">Third solution, use a store library like vuex.</span></h5>



<p>The third proposed solution is using a store library. With stores, your global state is both readable and writable anywhere in your application. The business logic related to data manipulation is moved to those stores. One of those libraries, <a href="https://next.vuex.vuejs.org/#what-is-a-state-management-pattern" target="_blank" rel="noreferrer noopener">Vuex</a>, is specially crafted to work with Vue and its internals.</p>



<blockquote class="wp-block-quote is-style-default">
<p>Vuex helps us deal with shared state management with the cost of more concepts and boilerplate. It&rsquo;s a trade-off between short term and long term productivity.</p>
<cite>Quoted from vuex documentation: « When Should I Use It? »</cite>
</blockquote>



<p>According to this quote, vuex is probably not necessary for our dead-simple application. Using props, custom events, provide and inject may gracefully to cover our needs.</p>



<p>However, it is still revelant to explore Vuex from a pedagogical point of view. So let&rsquo;s give it a try for this tutorial series.</p>



<p class="exercice"><strong>Exercise 5</strong>: Move the <code>user</code> property from the <code>App</code> component state to a store managed with vuex. Drop the event chain and let <code>SigninButton</code> directly call a <a href="https://next.vuex.vuejs.org/guide/mutations.html" target="_blank" rel="noreferrer noopener">mutation</a> in the store.</p>



<p class="question"><strong>Question 5</strong>: Build a comparison table between the various state management strategies available, especially about pro and cons. Optionally, feel free to explore other ways not covered in that tutorial.</p>



<p class="question"><strong>Question 6</strong>: Imagine a developer in your team suggests to exclusively manage the state with stores. Therefore, it recommends not to rely on <code>props</code> and <code>provide</code> anymore. Would you accept this? An argued answer is expected.</p>



<h4>Client-side routing</h4>



<p><i class="fas fa-exclamation-circle" style="color: #d32f2f; margin-right: 0.5em"></i> Unfortunately, we are running out of time. Client-side routing was supposed to be the main part of the next tutorial. Instead, this section will cover the basis of vue-router.</p>



<figure class="wp-block-table is-style-stripes"><table><tbody>
<tr>
<td>/</td>
<td>Displays the <code>HomePage</code> component as it is currently defined.</td>
</tr>
<tr>
<td>/conversations</td>
<td>Displays the <code>ConversationsIndexPage</code> component that displays the more recent conversations inside the user&rsquo;s mailbox.</td>
</tr>
<tr>
<td>/conversations/:id</td>
<td>Displays the <code>ConversationShowPage</code> component that fetches and renders the content of a given conversation (id retrieved from the API).</td>
</tr>
</tbody></table>
<figcaption>Expected routes at the end of the tutorial</figcaption></figure>



<p class="exercice"><strong>Exercise 7</strong>: Install vue-router v4+ according to <a href="https://next.router.vuejs.org/installation.html" target="_blank" rel="noreferrer noopener">official documentation</a>. Make sure to pick the version compatible with Vue3, (also compatible with vue-router v4+).</p>



<p class="exercice"><strong>Exercise 8</strong>: Using the <a href="https://next.router.vuejs.org/guide/" target="_blank" rel="noreferrer noopener">Getting Started</a> guide, add <code>/</code> and <code>/conversations</code> routes. Define the router inside its own ES module (ex. <code>src/router/index.js</code>). For now, the <code>ConversationsIndexPage</code> should just contain a placeholder (a small message to visually see that the route works fine).</p>



<p><strong>Tips</strong>: for the previous question, you need:</p>



<ul>
<li>to add <code>src/router/index.js</code> and export a router built with <code>createRouter()</code>.</li>
<li>to import the router in <code>src/main.js</code> and call <code>.use(router)</code> somewhere&#8230;</li>
<li>to use <code>&lt;router-view /&gt;</code> instead of <code>&lt;home-page /&gt;</code> somewhere&#8230;</li>
<li>to create another component for the new page.</li>
</ul>



<p class="exercice"><strong>Exercise 9</strong>: You probably tested your routes by directly changing the URL. However, a normal user clicks on links and buttons. Help them by adding a link to the header that targets the <code>/conversations</code> routes. That link should only be visible for logged users. It must use the <code>&lt;router-link /></code>.</p>



<div class="wp-block-columns">
<div class="wp-block-column question">
<p><strong>Question 7</strong>: What is the performance difference between:</p>



<ul style="margin-left: 1em; margin-bottom: 0">
<li><code>&lt;a href="/conversations"&gt;Conversation&lt;/a&gt;</code></li>
<li><code>&lt;router-link to="/conversations"&gt;Conversations&lt;/router-link&gt;</code></li>
</ul>
</div>
</div>



<p class="exercice"><strong>Exercise 10</strong>: In the case the user tries to access <code>/conversations</code> without being logged-in, it should be redirected to the home page. Use a <a href="https://router.vuejs.org/guide/advanced/navigation-guards.html#global-before-guards" target="_blank" rel="noreferrer noopener">guard</a> to implement this behaviour.</p>



<p class="exercice">In a real-world app, I would require a UI feedback, so the user knows it was not allowed to access the previous URL and was redirected. While not being part of the tutorial, it is part of the project UX!</p>



<p class="exercice"><strong>Exercise 11</strong>: Implement the <code>/conversations/:id</code> route. For now, the newly created <code>ConversationShowPage</code> component should access the id given in the URL and display it inside the template.</p>



<p>At this step, the routing capabilities are fine. The next step would be to fetch conversations from Outlook using the API and eventually display them in the UI. Unfortunately, we do not have any more in-class session for that.</p>



<p><strong>Tips</strong>: If you want to complete the tutorial yourself, you must ask another authorisation for the API. The scope <em><code>Mail.Read</code></em> is needed to fetch mails (see <code>src/lib/microsoftGraph.js</code>).</p>
<style class="advgb-styles-renderer">.wp-block-code {
	border: 0;
	padding: 0;
}

.wp-block-code > div {
	overflow: auto;
}

.shcb-language {
	border: 0;
	clip: rect(1px, 1px, 1px, 1px);
	-webkit-clip-path: inset(50%);
	clip-path: inset(50%);
	height: 1px;
	margin: -1px;
	overflow: hidden;
	padding: 0;
	position: absolute;
	width: 1px;
	word-wrap: normal;
	word-break: normal;
}

.hljs {
	box-sizing: border-box;
}

.hljs.shcb-code-table {
	display: table;
	width: 100%;
}

.hljs.shcb-code-table > .shcb-loc {
	color: inherit;
	display: table-row;
	width: 100%;
}

.hljs.shcb-code-table .shcb-loc > span {
	display: table-cell;
}

.wp-block-code code.hljs:not(.shcb-wrap-lines) {
	white-space: pre;
}

.wp-block-code code.hljs.shcb-wrap-lines {
	white-space: pre-wrap;
}

.hljs.shcb-line-numbers {
	border-spacing: 0;
	counter-reset: line;
}

.hljs.shcb-line-numbers > .shcb-loc {
	counter-increment: line;
}

.hljs.shcb-line-numbers .shcb-loc > span {
	padding-left: 0.75em;
}

.hljs.shcb-line-numbers .shcb-loc::before {
	border-right: 1px solid #ddd;
	content: counter(line);
	display: table-cell;
	padding: 0 0.75em;
	text-align: right;
	-webkit-user-select: none;
	-moz-user-select: none;
	-ms-user-select: none;
	user-select: none;
	white-space: nowrap;
	width: 1%;
}</style>	</div>
<!-- .entry-content -->

	
	<img width="100%" src="https://thomas-veillard.fr/wp-content/uploads/2021/02/great-job.jpg">
	<footer class="entry-footer">
		<span class="cat-links"><span class="screen-reader-text">Catégories </span><a href="https://thomas-veillard.fr/category/front-end-web-development/vue/" rel="category tag">03. VueJS</a>, <a href="https://thomas-veillard.fr/category/front-end-web-development/" rel="category tag">Modern web development</a></span>			</footer><!-- .entry-footer -->

</article><!-- #post-3522 -->


	<nav class="navigation post-navigation" role="navigation" aria-label="Publications">
		<h2 class="screen-reader-text">Navigation de l’article</h2>
		<div class="nav-links">
<div class="nav-previous"><a href="https://thomas-veillard.fr/front-end-web-development/vue/01-vue-practical-activity-part-n1/" rel="prev"><span class="meta-nav" aria-hidden="true">Précédent</span> <span class="screen-reader-text">Article précédent&nbsp;:</span> <span class="post-title">01. Vue: practical activity, part n°1</span></a></div>
<div class="nav-next"><a href="https://thomas-veillard.fr/front-end-web-development/vue/project/" rel="next"><span class="meta-nav" aria-hidden="true">Suivant</span> <span class="screen-reader-text">Article suivant&nbsp;:</span> <span class="post-title">03. Vue.js project</span></a></div>
</div>
	</nav>
		</main><!-- .site-main -->
	</div>
<!-- .content-area -->


	</div>
<!-- .site-content -->

</div>
<!-- .site -->

<script src="https://kit.fontawesome.com/f02a77f3db.js" crossorigin="anonymous"></script>
<script src="https://thomas-veillard.fr/wp-content/plugins/thomas/js/main.js"></script>
<script data-ad-client="ca-pub-9505048372269906" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NH45PR7ELJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NH45PR7ELJ');
</script>
<script src="https://thomas-veillard.fr/wp-content/themes/twentyfifteen/js/skip-link-focus-fix.js?ver=20141028" id="twentyfifteen-skip-link-focus-fix-js"></script>
<script id="twentyfifteen-script-js-extra">
var screenReaderText = {"expand":"<span class=\"screen-reader-text\">ouvrir le sous-menu<\/span>","collapse":"<span class=\"screen-reader-text\">fermer le sous-menu<\/span>"};
</script>
<script src="https://thomas-veillard.fr/wp-content/themes/twentyfifteen/js/functions.js?ver=20171218" id="twentyfifteen-script-js"></script>
<script src="https://thomas-veillard.fr/wp-includes/js/wp-embed.min.js?ver=5.7.4" id="wp-embed-js"></script>

</body>
</html>